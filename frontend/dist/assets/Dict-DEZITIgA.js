import{h as I}from"./http-g9MZ8hgC.js";import{d as O,c as V,a as Q,b as t,w as o,h as D,j as y,r as i,o as s,g as p,t as W,m as k,F as w,k as g,q as S,l as B,E as $,_ as X}from"./index-OWjV_rHx.js";const Y={class:"toolbar"},Z=O({__name:"Dict",setup(h){const r=D({level:void 0,keyword:""}),C=y([]),P=y([]),_=y([]),f=y(!1),e=D({id:void 0,level:1,parentId:0,stationParentId:void 0,name:"",sortNum:0}),N=B(()=>_.value.map(n=>({id:n.id,name:n.name}))),E=B(()=>{if(!e.stationParentId)return[];const n=_.value.find(l=>l.id===e.stationParentId);return((n==null?void 0:n.children)||[]).map(l=>({id:l.id,name:l.name}))}),F=n=>n===1?"车间":n===2?"工区":n===3?"安装地点":"",U=()=>{P.value=C.value.filter(n=>!(r.level&&n.level!==r.level||r.keyword&&!String(n.name||"").includes(r.keyword)))},c=async()=>{const[n,l]=await Promise.all([I.get("/location/list"),I.get("/location/tree")]);C.value=n.data||[],_.value=l.data||[],U()},L=()=>{r.level=void 0,r.keyword="",U()},R=()=>{e.level===1?(e.parentId=0,e.stationParentId=void 0):(e.level,e.parentId=void 0,e.stationParentId=void 0)},z=()=>{e.parentId=void 0},j=()=>{e.id=void 0,e.level=1,e.parentId=0,e.stationParentId=void 0,e.name="",e.sortNum=0,f.value=!0},q=n=>{if(e.id=n.id,e.level=n.level,e.name=n.name,e.sortNum=n.sortNum||0,n.level===1)e.parentId=0,e.stationParentId=void 0;else if(n.level===2){const l=_.value.find(d=>d.name===n.station);e.parentId=l==null?void 0:l.id,e.stationParentId=void 0}else{const l=_.value.find(u=>u.name===n.station);e.stationParentId=l==null?void 0:l.id;const d=((l==null?void 0:l.children)||[]).find(u=>u.name===n.area);e.parentId=d==null?void 0:d.id}f.value=!0},M=async()=>{if(!e.name||!String(e.name).trim()){$.error("请输入名称");return}if(e.level!==1&&!e.parentId){$.error("请选择上级节点");return}await I.post("/location/save",{id:e.id,level:e.level,parentId:e.level===1?0:e.parentId,name:String(e.name).trim(),sortNum:e.sortNum||0}),f.value=!1,await c()},T=async n=>{await I.delete(`/location/${n}`),await c()};return c(),(n,l)=>{const d=i("el-option"),u=i("el-select"),x=i("el-input"),v=i("el-button"),m=i("el-table-column"),A=i("el-table"),b=i("el-form-item"),G=i("el-input-number"),H=i("el-form"),J=i("el-dialog");return s(),V("div",null,[Q("div",Y,[t(u,{modelValue:r.level,"onUpdate:modelValue":l[0]||(l[0]=a=>r.level=a),placeholder:"层级",class:"field",clearable:""},{default:o(()=>[t(d,{label:"车间",value:1}),t(d,{label:"工区",value:2}),t(d,{label:"安装地点",value:3})]),_:1},8,["modelValue"]),t(x,{modelValue:r.keyword,"onUpdate:modelValue":l[1]||(l[1]=a=>r.keyword=a),placeholder:"名称关键字",class:"field"},null,8,["modelValue"]),t(v,{type:"primary",onClick:c},{default:o(()=>[...l[10]||(l[10]=[p("搜索",-1)])]),_:1}),t(v,{onClick:L},{default:o(()=>[...l[11]||(l[11]=[p("重置",-1)])]),_:1}),t(v,{type:"success",onClick:j},{default:o(()=>[...l[12]||(l[12]=[p("新增",-1)])]),_:1})]),t(A,{data:P.value,border:""},{default:o(()=>[t(m,{prop:"station",label:"车间","min-width":"180"}),t(m,{prop:"area",label:"工区","min-width":"180"}),t(m,{prop:"address",label:"安装地点","min-width":"180"}),t(m,{prop:"level",label:"层级",width:"100"},{default:o(a=>[p(W(F(a.row.level)),1)]),_:1}),t(m,{prop:"name",label:"节点名称","min-width":"180"}),t(m,{prop:"path",label:"完整路径","min-width":"280"}),t(m,{prop:"sortNum",label:"排序",width:"100"}),t(m,{label:"操作",width:"160"},{default:o(a=>[t(v,{size:"small",onClick:K=>q(a.row)},{default:o(()=>[...l[13]||(l[13]=[p("编辑",-1)])]),_:1},8,["onClick"]),t(v,{size:"small",type:"danger",onClick:K=>T(a.row.id)},{default:o(()=>[...l[14]||(l[14]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),t(J,{modelValue:f.value,"onUpdate:modelValue":l[9]||(l[9]=a=>f.value=a),title:"地点配置",width:"520px"},{footer:o(()=>[t(v,{onClick:l[8]||(l[8]=a=>f.value=!1)},{default:o(()=>[...l[15]||(l[15]=[p("取消",-1)])]),_:1}),t(v,{type:"primary",onClick:M},{default:o(()=>[...l[16]||(l[16]=[p("保存",-1)])]),_:1})]),default:o(()=>[t(H,{model:e,"label-width":"90px"},{default:o(()=>[t(b,{label:"层级"},{default:o(()=>[t(u,{modelValue:e.level,"onUpdate:modelValue":l[2]||(l[2]=a=>e.level=a),style:{width:"100%"},onChange:R},{default:o(()=>[t(d,{label:"车间",value:1}),t(d,{label:"工区",value:2}),t(d,{label:"安装地点",value:3})]),_:1},8,["modelValue"])]),_:1}),e.level===2?(s(),k(b,{key:0,label:"所属车间"},{default:o(()=>[t(u,{modelValue:e.parentId,"onUpdate:modelValue":l[3]||(l[3]=a=>e.parentId=a),style:{width:"100%"},filterable:""},{default:o(()=>[(s(!0),V(w,null,g(N.value,a=>(s(),k(d,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):S("",!0),e.level===3?(s(),V(w,{key:1},[t(b,{label:"所属车间"},{default:o(()=>[t(u,{modelValue:e.stationParentId,"onUpdate:modelValue":l[4]||(l[4]=a=>e.stationParentId=a),style:{width:"100%"},filterable:"",onChange:z},{default:o(()=>[(s(!0),V(w,null,g(N.value,a=>(s(),k(d,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"所属工区"},{default:o(()=>[t(u,{modelValue:e.parentId,"onUpdate:modelValue":l[5]||(l[5]=a=>e.parentId=a),style:{width:"100%"},filterable:""},{default:o(()=>[(s(!0),V(w,null,g(E.value,a=>(s(),k(d,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})],64)):S("",!0),t(b,{label:"名称"},{default:o(()=>[t(x,{modelValue:e.name,"onUpdate:modelValue":l[6]||(l[6]=a=>e.name=a),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),t(b,{label:"排序"},{default:o(()=>[t(G,{modelValue:e.sortNum,"onUpdate:modelValue":l[7]||(l[7]=a=>e.sortNum=a),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),te=X(Z,[["__scopeId","data-v-37d75f54"]]);export{te as default};
