import{d as te,i as oe,c as x,a as M,b as a,w as o,h as D,j as _,r as p,o as b,F as U,k as w,g as v,l as $,E as L,f as ne,m as z,_ as se}from"./index-OWjV_rHx.js";import{h as C}from"./http-g9MZ8hgC.js";const re={class:"toolbar"},de={class:"pager"},ue=te({__name:"Box",setup(ie){const r=D({station:"",area:"",address:""}),O=_([]),A=_(1),I=_(10),B=_(0),g=_(!1),t=D({}),k=_([]),T=ne(),E=$(()=>k.value.map(n=>n.name)),F=n=>{const e=k.value.find(i=>i.name===n);return((e==null?void 0:e.children)||[]).map(i=>i.name)},N=$(()=>F(r.station)),j=$(()=>F(t.station||"")),q=async()=>{var n;try{const e=await C.get("/location/tree");k.value=e.data||[]}catch{const i=((n=(await C.get("/box/page",{params:{pageNum:1,pageSize:1e3}})).data)==null?void 0:n.records)||[],f=new Map;i.forEach(d=>{const s=d.station||"",u=d.area||"",y=d.boxAddress||"";if(!s||!u||!y)return;f.has(s)||f.set(s,new Map);const c=f.get(s);c.has(u)||c.set(u,new Set),c.get(u).add(y)}),k.value=Array.from(f.entries()).map(([d,s])=>({name:d,children:Array.from(s.entries()).map(([u,y])=>({name:u,children:Array.from(y).map(c=>({name:c}))}))}))}},V=async()=>{const e=(await C.get("/box/page",{params:{pageNum:A.value,pageSize:I.value,station:r.station,area:r.area,address:r.address}})).data;O.value=e.records||[],B.value=e.total||0},R=()=>{r.station="",r.area="",r.address="",V()},G=()=>{N.value.includes(r.area)||(r.area="")},H=()=>{},J=()=>{Object.keys(t).forEach(n=>delete t[n]),g.value=!0},K=n=>{Object.keys(t).forEach(e=>delete t[e]),Object.assign(t,n),g.value=!0},P=()=>{j.value.includes(t.area)||(t.area="")},Q=()=>{},W=async()=>{if(!t.boxId||!String(t.boxId).trim()){L.error("请输入台帐号");return}if(!t.station||!t.area||!t.boxAddress){L.error("请选择车间、工区和安装地点");return}await C.post("/box/save",t),g.value=!1,V()},X=async n=>{await C.delete(`/box/${n}`),V()},Y=n=>{T.push({path:`/box-detail/${n.id}`,query:{boxId:n.boxId||""}})},Z=n=>{window.open(`/api/box/print/${n}`,"_blank")},h=n=>{I.value=n,V()},ee=n=>{A.value=n,V()};return oe(async()=>{await q(),await V()}),(n,e)=>{const i=p("el-option"),f=p("el-select"),d=p("el-input"),s=p("el-button"),u=p("el-table-column"),y=p("el-table"),c=p("el-pagination"),m=p("el-form-item"),le=p("el-form"),ae=p("el-dialog");return b(),x("div",null,[M("div",re,[a(f,{modelValue:r.station,"onUpdate:modelValue":e[0]||(e[0]=l=>r.station=l),placeholder:"车间",class:"field",clearable:"",filterable:"",onChange:G},{default:o(()=>[(b(!0),x(U,null,w(E.value,l=>(b(),z(i,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(f,{modelValue:r.area,"onUpdate:modelValue":e[1]||(e[1]=l=>r.area=l),placeholder:"工区",class:"field",clearable:"",filterable:"",onChange:H},{default:o(()=>[(b(!0),x(U,null,w(N.value,l=>(b(),z(i,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(d,{modelValue:r.address,"onUpdate:modelValue":e[2]||(e[2]=l=>r.address=l),placeholder:"安装地点",class:"field",clearable:""},null,8,["modelValue"]),a(s,{type:"primary",onClick:V},{default:o(()=>[...e[15]||(e[15]=[v("搜索",-1)])]),_:1}),a(s,{onClick:R},{default:o(()=>[...e[16]||(e[16]=[v("重置",-1)])]),_:1}),a(s,{type:"success",onClick:J},{default:o(()=>[...e[17]||(e[17]=[v("新增",-1)])]),_:1})]),a(y,{data:O.value,border:""},{default:o(()=>[a(u,{prop:"boxId",label:"台帐号"}),a(u,{prop:"station",label:"车间"}),a(u,{prop:"area",label:"工区"}),a(u,{prop:"boxAddress",label:"安装地点"}),a(u,{prop:"size",label:"规格"}),a(u,{label:"操作",width:"340"},{default:o(l=>[a(s,{size:"small",onClick:S=>K(l.row)},{default:o(()=>[...e[18]||(e[18]=[v("编辑",-1)])]),_:1},8,["onClick"]),a(s,{size:"small",type:"danger",onClick:S=>X(l.row.id)},{default:o(()=>[...e[19]||(e[19]=[v("删除",-1)])]),_:1},8,["onClick"]),a(s,{size:"small",type:"primary",onClick:S=>Z(l.row.id)},{default:o(()=>[...e[20]||(e[20]=[v("打印",-1)])]),_:1},8,["onClick"]),a(s,{size:"small",type:"success",onClick:S=>Y(l.row)},{default:o(()=>[...e[21]||(e[21]=[v("查看详细信息",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),M("div",de,[a(c,{layout:"total, sizes, prev, pager, next, jumper",total:B.value,"page-size":I.value,"current-page":A.value,"page-sizes":[5,10,20,50],onSizeChange:h,onCurrentChange:ee},null,8,["total","page-size","current-page"])]),a(ae,{modelValue:g.value,"onUpdate:modelValue":e[14]||(e[14]=l=>g.value=l),title:"配电箱",width:"700px"},{footer:o(()=>[a(s,{onClick:e[13]||(e[13]=l=>g.value=!1)},{default:o(()=>[...e[22]||(e[22]=[v("取消",-1)])]),_:1}),a(s,{type:"primary",onClick:W},{default:o(()=>[...e[23]||(e[23]=[v("保存",-1)])]),_:1})]),default:o(()=>[a(le,{model:t,"label-width":"90px"},{default:o(()=>[a(m,{label:"台帐号"},{default:o(()=>[a(d,{modelValue:t.boxId,"onUpdate:modelValue":e[3]||(e[3]=l=>t.boxId=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"车间"},{default:o(()=>[a(f,{modelValue:t.station,"onUpdate:modelValue":e[4]||(e[4]=l=>t.station=l),style:{width:"100%"},filterable:"",onChange:P},{default:o(()=>[(b(!0),x(U,null,w(E.value,l=>(b(),z(i,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"工区"},{default:o(()=>[a(f,{modelValue:t.area,"onUpdate:modelValue":e[5]||(e[5]=l=>t.area=l),style:{width:"100%"},filterable:"",onChange:Q},{default:o(()=>[(b(!0),x(U,null,w(j.value,l=>(b(),z(i,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"安装地点"},{default:o(()=>[a(d,{modelValue:t.boxAddress,"onUpdate:modelValue":e[6]||(e[6]=l=>t.boxAddress=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"规格"},{default:o(()=>[a(d,{modelValue:t.size,"onUpdate:modelValue":e[7]||(e[7]=l=>t.size=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"系统图"},{default:o(()=>[a(d,{modelValue:t.systemUrl,"onUpdate:modelValue":e[8]||(e[8]=l=>t.systemUrl=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"图片1"},{default:o(()=>[a(d,{modelValue:t.firstUrl,"onUpdate:modelValue":e[9]||(e[9]=l=>t.firstUrl=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"图片2"},{default:o(()=>[a(d,{modelValue:t.secondUrl,"onUpdate:modelValue":e[10]||(e[10]=l=>t.secondUrl=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"图片3"},{default:o(()=>[a(d,{modelValue:t.thirdUrl,"onUpdate:modelValue":e[11]||(e[11]=l=>t.thirdUrl=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"图片4"},{default:o(()=>[a(d,{modelValue:t.fourthUrl,"onUpdate:modelValue":e[12]||(e[12]=l=>t.fourthUrl=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),fe=se(ue,[["__scopeId","data-v-ecbcced9"]]);export{fe as default};
