# DistributionBox — 执行结果归档（v1.7）

- 对应需求：`docs/demands/v1.7.md`
- 优先级：P0
- 执行时间：2026-02-11（初次） + 2026-02-12（复测）
- 状态：已完成（2026-02-12 UI 实测通过）

## 根因定位
- 检测页保存后会触发列表刷新；列表解析使用了 `content/totalElements`，但后端 `detect/page` 实际返回 MyBatis-Plus 分页结构 `records/total`（包装在 `Result.data` 内），导致刷新数据异常。
- 前端请求仅发送 `Authorization: Bearer <token>`；后端鉴权拦截器实现读取的是 `token` 请求头。鉴权开启时，检测保存/刷新链路会有 401 风险并触发前端登出跳转。

## 代码改动（最小化）
- `frontend/src/views/Detect.vue`
  - 列表解析改为兼容：`records|content`、`total|totalElements`，并兼容 `res.data.data`/`res.data`。
- `frontend/src/api/http.ts`
  - 在请求拦截器中补充 `token` 请求头，同时保留 `Authorization`，兼容后端两种取 token 方式。

## 验证
- 本地构建验证：`cd frontend && npm run build` 通过。
- 逻辑验证点：
  - 保存检测记录后不再进入 401 登出链路（请求头兼容）。
  - 保存后刷新可正确读取分页结果并回显新增数据。

## 2026-02-12 UI 复测记录（真实点击）
- 场景：登录 admin -> 进入“检测” -> 新增 -> 填写 `pid=10086`、编号状态/外观状态/温度状态为“正常” -> 点击保存。
- 结果：
  - 未跳转 `/login`；
  - 页面仍停留在“检测”模块；
  - 列表显示新增记录（`10086 / 正常 / 正常 / 正常`）。
- 结论：v1.7 缺陷本轮复测通过。

