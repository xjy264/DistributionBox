# DistributionBox — 执行结果归档（v1.10）

- 对应需求：`docs/demands/v1.10.md`
- 执行时间：2026-02-12
- 状态：已完成（登录回跳修复 + SQL已执行）

## 根因
1. v1.8 前端在进入配电箱页时会请求 `/location/tree`。
2. 当前运行后端对 `/location/*` 返回 401，触发前端全局 401 登出逻辑，导致“登录后立刻回登录页”。
3. v1.8 迁移 SQL 未自动执行，`sys_location` 表未落库。

## 修复动作
- `frontend/src/api/http.ts`
  - 调整 401 自动登出条件：`/location/` 请求不触发强制登出，避免登录态被误清空。
- `frontend/src/views/Box.vue`
  - `loadLocations()` 增加降级逻辑：
    - 优先请求 `/location/tree`
    - 失败时改为从 `/box/page` 数据推导车间/工区/安装地点联动选项，保证页面可用。
- SQL 执行
  - 手动执行：`sql/migrations/V20__create_sys_location.sql`
  - 已创建并写入 `sys_location`（level1=9, level2=35）。
- 同步补齐后端 location 能力代码（供后端重启后使用）
  - 新增：`backend` 模块的 `Location` entity/mapper/service/controller。

## 验证结果
1. UI：登录 admin 后不再立即回跳 `/login`（通过）
2. UI：进入配电箱页面可正常展示并可操作（通过）
3. SQL：`sys_location` 已存在且有迁移数据（通过）

## 备注
- 若你要启用真正的 `/location/*` 后端接口（而非前端降级模式），请重启当前 8888 后端进程加载新增 `backend` 代码。
